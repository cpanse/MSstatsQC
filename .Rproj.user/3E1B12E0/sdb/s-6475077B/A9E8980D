{
    "collab_server" : "",
    "contents" : "#' A Cumulative Sum (CUSUM) Function\n#'\n#' This function allows you to calculate CUSUM statistics.\n#' @param data Comma-separated (*.csv), QC file format. It should contain a Precursor column and the metrics columns.\n#' @param peptide The name of precursor you want to draw the plot for\n#' @param L Lower bound of the giude set. Defaults to L = 1\n#' @param U Upper bound of the guide set. Defaults to U = 5\n#' @param ytitle The y-axis title of the plot.Defaults to \"CUSUM Plot\". The x-axis title is by default \"QCno-name of peptide\"\n#' @param type can take two values, \"mean\" or \"dispersion\". Defaults to \"mean\"\n#' @keywords Cumulative Sum, control chart\n#' @export\n#' @import dplyr\n#' @import plotly\n#' @import RecordLinkage\n#' @examples\n#' CUSUM.plot()\n\n#################################################################################################\nCUSUM.plot <- function(data, peptide, L = 1, U = 5, metric, normalization = TRUE,  ytitle = \"CUSUM Plot\", type = \"mean\") {\n  data <- input_checking(data)\n  if(!is.data.frame(data)){\n    stop(data)\n  }\n  CUSUM.outrange.thld <- 5\n  metricData <- getMetricData(data, peptide, L, U, metric, normalization)\n  plot.data <- CUSUM.data.prepare(data, metricData, peptide, L, U, type)\n\n  #ymax=ifelse(max(plot.data$CUSUM)>=CUSUM.outrange.thld,(max(plot.data$CUSUM)),CUSUM.outrange.thld)\n  #ymin=ifelse(min(plot.data$CUSUM)<=-CUSUM.outrange.thld,(min(plot.data$CUSUM)),-CUSUM.outrange.thld)\n\n  x <- list(\n    title =  paste(\"QCno - \", peptide),\n    range = c(0, max(plot.data$QCno))\n  )\n  y <- list(\n    title = ytitle\n  )\n\n  p <- plot_ly(plot.data\n               , x = QCno\n               , y = CUSUM.poz\n               , line = list(color = \"dodgerblue\")\n               , name = \"CUSUM+\"\n               , showlegend = FALSE\n               , text = Annotations\n  ) %>%\n    add_trace(  x = QCno\n                , y = CUSUM.neg\n                , line = list(color = \"blue\")\n                , name = \"CUSUM-\"\n                , showlegend = FALSE\n                , text = Annotations\n    ) %>%\n    layout(xaxis = x,yaxis = y, showlegend = FALSE) %>%\n    add_trace(x=c(0, max(plot.data$QCno)),y = c(CUSUM.outrange.thld,CUSUM.outrange.thld), marker=list(color=\"red\" , size=4 , opacity=0.5), name = \"UCL\",showlegend = FALSE) %>%\n    add_trace(x=c(0, max(plot.data$QCno)),y = c(-CUSUM.outrange.thld,-CUSUM.outrange.thld), marker=list(color=\"red\" , size=4 , opacity=0.5), name = \"LCL\",showlegend = FALSE) %>%\n    add_trace(  x = QCno\n                , y = CUSUM.neg\n                , mode = \"markers\"\n                , marker=list(color=\"blue\" , size=5 , opacity=0.5)\n                , showlegend = FALSE,name=\"\"\n    ) %>%\n    add_trace(  x = QCno\n                , y = CUSUM.poz\n                , mode = \"markers\"\n                , marker=list(color=\"blue\" , size=5 , opacity=0.5)\n                , showlegend = FALSE,name=\"\"\n    ) %>%\n    add_trace(x = plot.data[CUSUM.poz <= -CUSUM.outrange.thld, ]$QCno,\n              y = plot.data[CUSUM.poz <= -CUSUM.outrange.thld, ]$CUSUM.poz,\n              mode = \"markers\",\n              marker=list(color=\"red\" , size=5 , opacity=0.5),\n              showlegend = FALSE,name=\"\"\n    ) %>%\n    add_trace(x = plot.data[CUSUM.poz >= CUSUM.outrange.thld, ]$QCno,\n              y = plot.data[CUSUM.poz >= CUSUM.outrange.thld, ]$CUSUM.poz,\n              mode = \"markers\",\n              marker=list(color=\"red\" , size=5 , opacity=0.5),\n              showlegend = FALSE,name=\"\"\n    )%>%\n    add_trace(x = plot.data[CUSUM.neg <= -CUSUM.outrange.thld, ]$QCno,\n              y = plot.data[CUSUM.neg <= -CUSUM.outrange.thld, ]$CUSUM.neg,\n              mode = \"markers\",\n              marker=list(color=\"red\" , size=5 , opacity=0.5),\n              showlegend = FALSE,name=\"\"\n    ) %>%\n    add_trace(x = plot.data[CUSUM.neg >= CUSUM.outrange.thld, ]$QCno,\n              y = plot.data[CUSUM.neg >= CUSUM.outrange.thld, ]$CUSUM.neg,\n              mode = \"markers\",\n              marker=list(color=\"red\" , size=5 , opacity=0.5),\n              showlegend = FALSE,name=\"\"\n    )\n\n  return(p)\n}\n",
    "created" : 1483807514554.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1247160473",
    "id" : "A9E8980D",
    "lastKnownWriteTime" : 1483809803,
    "last_content_update" : 1483809803247,
    "path" : "~/GitHub/MSstatsQC/R/CUSUM.plot.R",
    "project_path" : "R/CUSUM.plot.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}